# euroricambi
Парсер сайта www.euroricambi.com

Полный комплект для автоматического парсинга сайта www.euroricambi.com
и сборки готового комплекта схем для подборщика версии 0.94.01.RC18 и выше

Порядок работы:
===============

1. В скрипте 1.Euroricambi_get_models_page_link.py настроить параметры 
       family_group_name
       family_group_link
   параметры должны быть обязательно в рамках одного бренда, например все 
   модели только ZF или все модели только MB.
   В начале скрипта отредактировать функцию
       def get_family_name(index_html):
   добавить название каждой подгруппы семейств и имя её индексного файла html. Те
   подгруппы, которые не содержат информации для наборов (например, просто список
   pdf файлов и т.п.) в функцию не включать. Если для двух разных подгрупп одного
   бренда будут одинаковые индексные файлы и названия подгрупп семейств - 
   внимательно проанализировать каждый случай. Скорее всего это допустимо, тогда 
   в функции просто закоментарить повторяющиеся блоки elif (удалять не надо, чтобы
   общая картина оставалась наглядной). Запустить скрипт - в результате его работы
   будет создан файл 
       models_link.csv
   Проанализировать файл и вычистить из него все строки, во втором столбце которых
   встретится "не определено".


2. В скрипте 2.Euroricambi_get_models_kit_check_and_repair.py в строке 456 
       lastkitNumber = get_models_kit(0)  
   установить параметр в скобках в 0 и запустить скрипт. В процессе
   работы возможны падения по причине отсутсвия отклика от сайта Euroricambi. После
   первого отсутствия отклика от сайта, скрипт автоматически перезапустится, после
   второго отсутствия отклика от сайта произойдёт падение скрипта.
   После падения, выяснить номер последнего успешно созданного набора в папке kit
   и установить этот номер в качестве параметра, после этого запустить скрипт снова.
   Как только скрипт обработает последний набор, будет автоматически запущена
   проверка наборов и выборочная докачка неполных наборов. Если в процессе докачки 
   произойдёт падение, то в скрипте параметр выставить по номеру последнего набора
   и скрипт запустить. Добиться успешного завершения работы второго скрипта до
   получения сообщения "Проверка наборов завершена". 
   В результате работы скрипта будет создана папка kit со всеми наборами. Количество
   наборов должно соответствовать количеству строк в файле models_link.csv
 

3. В скрипте 3.Euroricambi_prepare_gearbox_&_linktable.py настроить параметр
   brandname = "название выбраннго бренда" 
   в соответствии с выбранным брендом в пункте 1. Запустить
   скрипт - в результате его работы в каждой папке набора будут созданы файлы
       pre_gearbox.csv 
       pre_linktable.csv
       pre_disable_href.csv
   Если скрипт остановился с сообщением "Дублирование gruppo в table.csv в наборе ХХ" -
   это означает, что в table.csv столбцы флажков имеют совпадающие названия или в
   названиях есть лишние знаки точки с запятой. В первом случае вручную отредактировать 
   table.csv, если при редактировании будет очищен столбец, то соответствующий ему 
   gruppoХХ.png подменить на пустой размером 205 байт. Во втором случае руками править
   ничего не надо. После этого в папку набора из корня скопировать скрипт fix_table.csv.py, 
   запустить, с файла table.csv автоматически будет сделана копия в table-кривой.csv, 
   оригинальный файл будет пофиксен. Запускать 3.Euroricambi_prepare_gearbox_&_linktable.py 
   и исправлять наборы до успешного завершения работы скрипта.  

   
4. В скрипте 4.Euroricambi_compile.py настроить параметры brandname, pref и dbname.
   Например:
       brandname = "ZF"
       pref="GBZF"
       dbname="no_password_ZF_GEARBOX_" 
   В результате работы скрипта будут созданы два комплекта схем, оригинальный
   английский и русский, в названиях будет автоматически подставлено число схем
   и признак notes 
       хххххх_ENG.sch
       хххххх_RUS.sch
   Комплекты схем (базы SQLite3) не запароленны и открыты для просмотра и
   редактирования, например, в программе SQLite Expert Professional 3.5.96.2516
   Так же в корне будут созданы вспомогательные файлы, задействованные в сборке
       gearbox_separator.csv
       linktable_eng.csv
       linktable_no_cross.csv
       linktable_rus.csv 


Ориентировочное время от старта работ до получения готового продукта всех КПП ZF
================================================================================

по пункту 1 ~ 1 минута
по пункту 2 ~ 386 минут
по пункту 3 =< 1 минуты
по пункту 4 ~ 11 минут

Итого ~ 399 минут
   

Исходный комплект набора
========================

1.Euroricambi_get_models_page_link.py - ссылки на страницы моделей
2.Euroricambi_get_models_kit_check_and_repair.py - парсинг комплектов по ссылкам
3.Euroricambi_prepare_gearbox_&_linktable.py - приведение к формату подборщика
4.Euroricambi_compile.py - сборка готового комплекта схем в формате подборщика
fix_table.csv.py - вспомогательный скрипт для восстановления строк в table.csv
no_password_blank.sch - пустая база SQLite3 в формате подборщика
cross_Euroricambi.csv - кросс номеров Euroricambi на коды товаров АДТС
cross_ZF.csv - кросс номеров ZF на коды товаров АДТС
cross_MB.csv - кросс номеров MB на коды товаров АДТС
.....
....
...
..
.

